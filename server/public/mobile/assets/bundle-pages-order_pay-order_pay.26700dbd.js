import{bk as e,bl as a,bm as t,bn as r,a1 as l,ad as s,a3 as o,bo as n,d as i,bp as u,W as d,y as c,o as m,k as f,f as p,e as y,w as _,g as v,t as w,b as x,F as b,l as g,bq as h,j as P,r as k,a as j,br as $,a5 as I,i as C,bs as S,bt as A}from"./index.9cb42b0a.js";import{_ as W}from"./u-count-down.3fe6fde2.js";import{_ as N}from"./u-image.b14343b7.js";import{_ as O}from"./u-popup.44c78583.js";import{_ as T}from"./plugin-vue_export-helper.21dcd24c.js";import"./u-icon.468cc24b.js";function q(){const i=async(t,r)=>{try{switch(r.pay_way){case 1:await(async t=>{await e({MP_WEIXIN:()=>new Promise(((e,a)=>{console.log(t,"weixin"),uni.requestPayment({provider:"wxpay",timeStamp:null==t?void 0:t.timeStamp,nonceStr:null==t?void 0:t.nonceStr,package:null==t?void 0:t.package,signType:null==t?void 0:t.signType,paySign:null==t?void 0:t.paySign,success:a=>e(a),fail:e=>a(e)})})),OA_WEIXIN:()=>a(t),H5:()=>new Promise(((e,a)=>{window.open(t,"_self"),e()})),APP:()=>new Promise(((e,a)=>{uni.requestPayment({provider:"wxpay",orderInfo:t,success:a=>e(a),cancel:e=>a(e),fail:e=>a(e)})}))})})(t.config);break;case 2:await(async a=>{await e({H5:()=>new Promise(((e,t)=>{const r=window.open("","_self");r.document.body.innerHTML=a,r.document.forms[0].submit(),e()})),APP:()=>new Promise(((e,t)=>{uni.requestPayment({provider:"alipay",orderInfo:a,success:a=>e("success"),cancel:e=>t("fail"),fail:e=>t("fail")})})),MP_TOUTIAO:()=>(console.log(a),new Promise(((e,t)=>{uni.requestPayment({provider:"alipay",orderInfo:a,service:1,success:a=>e(a),cancel:e=>t(e),fail:e=>t(e)})})))})})(t.config);break;default:uni.$u.toast("支付异常")}const l=JSON.stringify({order_id:r.order_id,from:r.from});if("recharge"===r.from)return o({url:"/bundle/pages/user_wallet/user_wallet?isPay=true"});o({url:`/bundle/pages/payment_result/payment_result?param=${l}`})}catch(l){if("order"===r.from&&o({url:"/pages/order/index"}),0==Number(r.order_amount))return uni.$u.toast("下单成功");uni.$u.toast("支付取消")}};return{initPayWay:async e=>{try{return await t({from:e.from||"order",order_id:e.order_id,scene:r()})}catch(a){console.log("获取支付方式",a)}},handlePayPrepay:async e=>{try{if(l().userInfo.pay_auth&&1==e.pay_way)return void s({content:"当前账号未微信授权，请前往个人设置授权",confirmText:"前往授权",success:function(e){e.confirm&&o({url:"/pages/user_set/user_set"})}});const a=await n({from:e.from||"order",pay_way:e.pay_way,order_id:e.order_id}),t=JSON.stringify({order_id:e.order_id,from:e.from});3!==e.pay_way?i(a,e):(o({url:`/bundle/pages/payment_result/payment_result?param=${t}`}),uni.$u.toast("支付成功"))}catch(a){uni.$u.toast(a)}},handlePay:i}}var M=T(i({__name:"order_pay",setup(e){const a=u(),{initPayWay:t,handlePayPrepay:r}=q(),l=d({from:"order",order_id:"",icon:"",order_amount:""}),n=d({cancel_time:"",order_amount:""}),i=d(),T=d(),M=d(!1),z=d("");function F(){const e=JSON.stringify({order_id:l.value.order_id,from:l.value.from});"order"==l.value.from&&o({url:`/bundle/pages/payment_result/payment_result?param=${e}`}),"recharge"==l.value.from&&o({url:"/bundle/pages/user_wallet/user_wallet?isPay=true"})}const E=async()=>{if(!(await s({title:"温馨提示",content:"确认支付吗？"})).cancel){if(2==i.value){if(navigator.userAgent.toLowerCase().match(/MicroMessenger/i))return void o({url:`/bundle/pages/toAlipay/toAlipay?order_id=${l.value.order_id}&from=${l.value.from}&pay_way=${i.value}&key=${a}`})}try{r({from:l.value.from,pay_way:i.value,order_id:l.value.order_id})}catch(e){console.log(e)}}};c((async e=>{(null==e?void 0:e.order_amount)&&(l.value.order_amount=null==e?void 0:e.order_amount,i.value=2),l.value.order_id=e.order_id,l.value.from=e.from,(async()=>{n.value=await t({...l.value}),T.value=1e3*(n.value.cancel_time-Date.now()/1e3);const e=n.value.lists.find((e=>e.is_default))||n.value.lists[0];i.value=null==e?void 0:e.pay_way})()}));const H=async e=>{await s({title:"温馨提示",showCancel:!1,content:"当前订单支付时间已过，请重新下单",success:()=>{o({url:"/pages/index/index"})}})};return(e,a)=>{const t=P,r=k(j("u-count-down"),W),s=k(j("u-image"),N),o=S,u=A,d=$,c=I,q=C,J=k(j("u-popup"),O);return m(),f(b,null,[p(' <u-navbar title="订单支付" @leftClick="handleleft"> </u-navbar> '),y(t,{class:"box flex justify-center items-center flex-col"},{default:_((()=>[y(t,{class:"box-text"},{default:_((()=>[v("￥"+w(n.value.order_amount),1)])),_:1}),T.value>=0&&"order"===l.value.from?(m(),x(t,{key:0,class:"box-time flex"},{default:_((()=>[v("支付剩余时间"),y(r,{timestamp:T.value,onEnd:H,format:"mm:ss","font-size":26,"separator-size":26},null,8,["timestamp"])])),_:1})):p("v-if",!0)])),_:1}),y(t,{class:"pay-box"},{default:_((()=>[y(d,null,{default:_((()=>[(m(!0),f(b,null,g(n.value.lists,(e=>(m(),x(t,{key:e.id,class:"item",onClick:a=>{return t=e.pay_way,void(i.value=t);var t}},{default:_((()=>[y(u,null,{default:_((()=>[y(t,{class:"flex justify-between items-center"},{default:_((()=>[y(t,{class:"flex items-center py-[20rpx] justify-between w-full"},{default:_((()=>[y(t,{class:"flex items-center"},{default:_((()=>[y(s,{src:e.image,width:"48",height:"48"},null,8,["src"]),y(t,{class:"pl-[20rpx]"},{default:_((()=>[y(t,{class:"text-[28rpx] text-[#333]"},{default:_((()=>[v(w(e.name),1)])),_:2},1024),y(t,{class:"pt-1 text-[24rpx] text-muted"},{default:_((()=>[v(w(e.extra),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),y(t,null,{default:_((()=>[y(o,{color:"#F36161",value:e.pay_way,checked:e.pay_way===i.value},null,8,["value","checked"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),p(' <u-radio-group v-model="payWay" class="radio" @change="radioChange">\n            <view\n                class="flex justify-between items-center item"\n                v-for="item in payData.lists"\n                :key="item.id"\n                @click="selectPayWay(item.pay_way)"\n            >\n                <view class="flex items-center py-[20rpx] justify-between w-full">\n                    <view class="flex">\n                        <u-image :src="item.image" width="48" height="48" />\n                        <view class="pl-[20rpx]">\n                            <view class="text-[28rpx] text-[#333]">{{ item.name }}</view>\n                            <view class="pt-1 text-[24rpx] text-muted">\n                                {{ item.extra }}\n                            </view>\n                        </view>\n                    </view>\n                    <view>\n                        <u-radio :name="item.pay_way" active-color="#F36161" />\n                    </view>\n                </view>\n            </view>\n        </u-radio-group> ')])),_:1}),y(t,{class:"bottom_box w-full p-[20rpx]"},{default:_((()=>[y(c,{class:"pay_btn",onClick:E},{default:_((()=>[v("立即支付")])),_:1})])),_:1}),y(J,{modelValue:M.value,"onUpdate:modelValue":a[1]||(a[1]=e=>M.value=e),mode:"bottom",height:"600rpx","safe-area-inset-bottom":"","border-radius":"20",closeable:"",onClose:F},{default:_((()=>[y(t,{style:{padding:"60rpx 30rpx",display:"flex","justify-content":"center","align-items":"center","flex-direction":"column"}},{default:_((()=>[y(t,{style:{"font-size":"50rpx",margin:"10rpx 0 20rpx"}},{default:_((()=>[v("￥"+w(n.value.order_amount),1)])),_:1}),y(t,{class:"flex row-between m-t-50",style:{width:"100%","justify-content":"space-between","font-weight":"bold"}},{default:_((()=>[y(q,{class:"bold"},{default:_((()=>[v("支付方式")])),_:1}),y(q,{class:"bold"},{default:_((()=>[v("支付宝")])),_:1})])),_:1}),y(t,{class:"p-20 m-t-50 m-b-50",style:{width:"100%","background-color":"#9e9e9e40",padding:"15rpx 15rpx",margin:"50rpx 0"}},{default:_((()=>[v("请复制链接,粘贴至浏览器并支付")])),_:1}),y(c,{onClick:a[0]||(a[0]=e=>(console.log(z.value),void h({data:z.value}))),style:{"border-radius":"12rpx",width:"100%",height:"80rpx","line-height":"80rpx","font-size":"28rpx",color:"white","background-color":"#F36161"}},{default:_((()=>[v("复制链接")])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-db316a02"]]);export{M as default};
